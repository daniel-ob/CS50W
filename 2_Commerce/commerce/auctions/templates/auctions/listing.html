{% extends "auctions/layout.html" %}

{% block title %}Auctions - {{ listing.title }} {% endblock %}

{% block body %}
    <div id="listing-page">
        <section class="main-info">
            <h1>{{ listing.title }}</h1>
            <figure>
                {% if listing.image_url %}
                    <img src="{{ listing.image_url }}" alt="{{ listing.title }}" />
                {% else %}
                    {% load static %}
                    <img src="{% static 'auctions/no_image.svg' %}" alt="No image" />
                    <figcaption>(No image has been uploaded for this listing)</figcaption>
                {% endif %}
            </figure>
            {% if listing.description %}
                <p class="description">{{ listing.description }}</p>
            {% endif %}
            <p class="price">
                <strong>
                {% if listing.bids.count %}
                    ${{ listing.bids.last.amount_dollars }}
                {% else %}
                    ${{ listing.starting_bid_dollars }}
                {% endif %}
                </strong>
            </p>
        </section>
        <section class="auction">
            {% if listing.is_active %}
                <div id="auction-state">
                    <p>Auction is open.</p>
                    {% if user == listing.user %}
                        <form action="{% url 'close' listing.id %}" method="post">
                            {% csrf_token %}
                            <input class="btn btn-primary" type="submit" value="Close" />
                        </form>
                    {% endif %}
                </div>
                <p>{{ listing.bids.count }} bid(s) so far.
                    {% if listing.bids.last.user == user %}
                        Your bid is the current bid
                    {% endif %}
                </p>
                {% if user.is_authenticated and user != listing.user %}
                    <form id="bid-form" action="{% url 'bid' listing.id %}" method="post">
                        {% csrf_token %}
                        {{ bid_form.as_p }}
                        <input class="btn btn-primary" type="submit" value="Place Bid" />
                    </form>
                    {% if message %}
                        <p class="error">{{ message }}</p>
                    {% endif %}
                {% endif %}
            {% else %}
                <p><strong>Auction is closed.</strong></p>
                <p>{{ listing.bids.count }} total bid(s).</p>
                {% if listing.bids.last.user == user %}
                    <p class="congrats"><strong>You won the auction.</strong></p>
                {% endif %}
            {% endif %}
        </section>
        <section class="details">
            <h2>Details:</h2>
            <ul>
                <li>Listed by: {{ listing.user.username }}</li>
                <li>Category:
                    {% if listing.category.name %}
                        {{ listing.category.name }}
                    {% else %}
                        No Category Listed
                    {% endif %}
                </li>
                <li>Created: {{ listing.creation_date }}</li>
            </ul>
        </section>
    </div>
{% endblock %}
